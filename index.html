<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Finance KPI Widget</title>

  <style>
    :root{
      --bg: #191919;
      --card: rgba(0,0,0,0.38);        /* less blurry: we use translucent, no backdrop blur */
      --stroke: rgba(255,255,255,0.12);
      --stroke2: rgba(255,255,255,0.20);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.62);

      --white: #ffffff;
      --green: #3EF28A;
      --red:   #FF4D6D;
      --blue:  #4DA3FF;

      --shadow: 0 18px 60px rgba(0,0,0,0.60);
      --r: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      overflow:hidden;
    }

    .frame{
      position:relative;
      height:100%;
      padding: 14px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: var(--shadow);
      overflow:hidden;
      background: var(--bg);
    }

    /* subtle animated texture */
    .texture{
      position:absolute; inset:-60px;
      background:
        repeating-linear-gradient(135deg,
          rgba(255,255,255,0.05) 0px,
          rgba(255,255,255,0.05) 1px,
          transparent 1px,
          transparent 48px
        );
      opacity: .14;
      animation: drift 14s linear infinite;
      pointer-events:none;
    }
    @keyframes drift{
      from{ transform: translateX(-60px); }
      to  { transform: translateX(60px); }
    }

    /* Flying money behind cards (low opacity) */
    .money{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .money i{
      position:absolute;
      left:-30%;
      top: var(--top);
      font-style: normal;
      font-size: var(--size);
      opacity: 0.10;                 /* low opacity */
      transform: translateZ(0);
      animation: fly var(--dur) linear infinite;
      animation-delay: var(--delay);
      filter: blur(0px);             /* no blur so you can see it */
      user-select:none;
      white-space:nowrap;
    }
    @keyframes fly{
      0%   { transform: translateX(-20vw) rotate(-8deg); }
      100% { transform: translateX(140vw) rotate(10deg); }
    }

    .top{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      z-index:2;
      margin-bottom: 10px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight: 850;
      letter-spacing: .02em;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 0 18px rgba(255,255,255,0.20);
    }
    .updated{ font-size:12px; color: var(--muted); }

    /* Layout: BIG left + 3 stacked right */
    .layout{
      position:relative;
      display:grid;
      grid-template-columns: 1.65fr 1fr;
      gap: 12px;
      z-index:2;
      min-height: 220px;
      height: calc(100% - 44px);
    }
    .stack{
      display:grid;
      grid-template-rows: repeat(3, 1fr);
      gap: 12px;
      height:100%;
    }

    .card{
      position:relative;
      border-radius: var(--r);
      background: var(--card);
      border: 1px solid var(--stroke);
      padding: 14px;
      overflow:hidden;
      transition: transform .16s ease, border-color .16s ease;
    }
    .card:hover{
      transform: translateY(-1px);
      border-color: var(--stroke2);
    }

    /* Glass animation (no blur): inner highlights + moving sheen */
    .card::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(600px 120px at 20% 0%, rgba(255,255,255,0.10), transparent 60%),
        radial-gradient(500px 90px at 80% 10%, rgba(255,255,255,0.07), transparent 55%);
      opacity: .55;
      pointer-events:none;
    }
    .card::after{
      content:"";
      position:absolute;
      inset:-60% -70%;
      background: linear-gradient(120deg,
        transparent 0%,
        rgba(255,255,255,0.04) 45%,
        rgba(255,255,255,0.12) 50%,
        rgba(255,255,255,0.04) 55%,
        transparent 100%);
      transform: translateX(-60%) rotate(10deg);
      animation: shimmer 7.5s ease-in-out infinite;
      opacity: .20;
      pointer-events:none;
    }
    @keyframes shimmer{
      0%,45%{ transform: translateX(-60%) rotate(10deg); }
      70%   { transform: translateX(25%) rotate(10deg); }
      100%  { transform: translateX(55%) rotate(10deg); }
    }

    /* Accent strip */
    .card .accent{
      position:absolute;
      left:0; top:0; bottom:0;
      width:3px;
      background: rgba(255,255,255,0.20);
    }
    .accent.white{ background: rgba(255,255,255,0.75); }
    .accent.blue{ background: var(--blue); }
    .accent.green{ background: var(--green); }
    .accent.red{ background: var(--red); }

    .row1{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      z-index:2;
    }
    .label{
      display:flex;
      align-items:center;
      gap: 10px;
      font-size:12px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .icon{
      width: 30px; height: 30px;
      display:grid; place-items:center;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.03);
    }

    .pill{
      font-size:11px;
      color: var(--muted);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.03);
      padding: 6px 10px;
      border-radius: 999px;
      display:flex; align-items:center; gap: 7px;
      white-space:nowrap;
      z-index:2;
      position:relative;
    }

    /* Big NET WORTH */
    .big{
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      min-height: 240px;
    }
    .bigValue{
      position:relative;
      z-index:2;
      margin-top: 18px;
      font-size: 56px;
      font-weight: 900;
      letter-spacing: .01em;
      line-height: 1.02;
      color: var(--white);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .subline{
      position:relative;
      z-index:2;
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      color: var(--muted);
      margin-top: 12px;
    }

    .value{
      position:relative;
      z-index:2;
      margin-top: 12px;
      font-size: 32px;
      font-weight: 900;
      line-height: 1.05;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .white{ color: var(--white); }
    .green{ color: var(--green); }
    .red{ color: var(--red); }
    .blue{ color: var(--blue); }

    /* Responsive */
    @media (max-width: 980px){
      body{ overflow:auto; }
      .layout{ grid-template-columns: 1fr; height:auto; }
      .stack{ height:auto; }
      .bigValue{ font-size: 46px; }
      .value{ font-size: 30px; }
    }

    @media (prefers-reduced-motion: reduce){
      .texture, .money i, .card::after{ animation:none !important; }
      .card{ transition:none !important; }
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="texture"></div>

    <!-- money behind -->
    <div class="money" aria-hidden="true">
      <i style="--top: 8%;  --size: 44px; --dur: 20s; --delay: -3s;">ðŸ’¸</i>
      <i style="--top: 18%; --size: 52px; --dur: 26s; --delay: -11s;">ðŸ’µ</i>
      <i style="--top: 30%; --size: 46px; --dur: 22s; --delay: -7s;">à§³</i>
      <i style="--top: 44%; --size: 56px; --dur: 30s; --delay: -15s;">ðŸ’°</i>
      <i style="--top: 58%; --size: 48px; --dur: 24s; --delay: -9s;">ðŸª™</i>
      <i style="--top: 72%; --size: 54px; --dur: 34s; --delay: -19s;">à§³à§³</i>
      <i style="--top: 84%; --size: 46px; --dur: 28s; --delay: -6s;">ðŸ’¸</i>
    </div>

    <div class="top">
      <div class="brand"><span class="dot"></span><span>Finance</span></div>
      <div id="updated" class="updated">Loadingâ€¦</div>
    </div>

    <div class="layout">
      <!-- BIG BOX: NET WORTH -->
      <div class="card big" id="cardNet">
        <span class="accent white"></span>
        <div class="row1">
          <div class="label">
            <span class="icon">
              <!-- white money bag -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M9 7c1.2 1.2 4.8 1.2 6 0" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M10 4h4" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M7.5 10.5c-1.6 1.6-2.5 3.5-2.5 6 0 4.2 3.6 6.5 7 6.5s7-2.3 7-6.5c0-2.5-.9-4.4-2.5-6" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9 11h6" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
              </svg>
            </span>
            <span>NET WORTH</span>
          </div>
          <div class="pill"><span class="white">â¬¤</span><span>Balance</span></div>
        </div>

        <div id="netWorth" class="bigValue">â€”</div>
        <div class="subline">
          <span>Savings âˆ’ Debt</span>
          <span id="netNote">â€”</span>
        </div>
      </div>

      <!-- RIGHT: 3 stacked -->
      <div class="stack">
        <!-- CASHFLOW blue -->
        <div class="card">
          <span class="accent blue"></span>
          <div class="row1">
            <div class="label">
              <span class="icon">
                <!-- blue money flow -->
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M7 7h10a3 3 0 0 1 0 6H9" stroke="var(--blue)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M9 13l-2-2 2-2" stroke="var(--blue)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M17 17H7a3 3 0 0 1 0-6h8" stroke="var(--blue)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M15 11l2 2-2 2" stroke="var(--blue)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              <span>CASHFLOW</span>
            </div>
            <div id="flowPill" class="pill"><span class="blue">â†•</span><span>This month</span></div>
          </div>
          <div id="cashflow" class="value blue">â€”</div>
        </div>

        <!-- INCOME green -->
        <div class="card">
          <span class="accent green"></span>
          <div class="row1">
            <div class="label">
              <span class="icon">
                <!-- green rising chart -->
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M4 19V5" stroke="var(--green)" stroke-width="1.9" stroke-linecap="round"/>
                  <path d="M4 19h16" stroke="var(--green)" stroke-width="1.9" stroke-linecap="round"/>
                  <path d="M7 14l4-4 3 3 5-6" stroke="var(--green)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M18 7h3v3" stroke="var(--green)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              <span>INCOME</span>
            </div>
            <div class="pill"><span class="green">â†—</span><span>This month</span></div>
          </div>
          <div id="incoming" class="value green">â€”</div>
        </div>

        <!-- EXPENSE red -->
        <div class="card">
          <span class="accent red"></span>
          <div class="row1">
            <div class="label">
              <span class="icon">
                <!-- red down chart -->
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M4 19V5" stroke="var(--red)" stroke-width="1.9" stroke-linecap="round"/>
                  <path d="M4 19h16" stroke="var(--red)" stroke-width="1.9" stroke-linecap="round"/>
                  <path d="M7 10l4 4 3-3 5 6" stroke="var(--red)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M18 17h3v-3" stroke="var(--red)" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              <span>EXPENSE</span>
            </div>
            <div class="pill"><span class="red">â†˜</span><span>This month</span></div>
          </div>
          <div id="outgoing" class="value red">â€”</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function fmt(n, currency){
      const sign = n < 0 ? "-" : "";
      const abs = Math.abs(n);
      return sign + currency + abs.toLocaleString();
    }

    async function load(){
      // Same-origin fetch (works in Notion embeds)
      const r = await fetch("/api?t=" + Date.now(), { cache: "no-store" });
      const j = await r.json();

      const c = j.currency || "à§³";
      const net = Number(j.netWorth ?? 0);
      const inc = Number(j.incoming ?? 0);
      const out = Number(j.outgoing ?? 0);
      const flow = Number(j.cashflow ?? 0);

      document.getElementById("netWorth").textContent = fmt(net, c);
      document.getElementById("cashflow").textContent = fmt(flow, c);
      document.getElementById("incoming").textContent = fmt(inc, c);
      document.getElementById("outgoing").textContent = fmt(out, c);

      document.getElementById("updated").textContent =
        "Updated â€¢ " + new Date(j.updatedAt).toLocaleString();

      document.getElementById("netNote").textContent =
        net >= 0 ? "OK" : "Negative";

      const flowPill = document.getElementById("flowPill");
      flowPill.innerHTML = flow >= 0
        ? '<span class="green">â†‘</span><span>Surplus</span>'
        : '<span class="red">â†“</span><span>Deficit</span>';
    }

    load().catch(() => {
      document.getElementById("updated").textContent = "Error loading data";
    });

    setInterval(() => load().catch(()=>{}), 60000);
  </script>
</body>
</html>
